<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pulpcore.plugin.content &mdash; Pulp Project 3.23.0.dev documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="pulpcore.plugin.util" href="util.html" />
    <link rel="prev" title="Profiling the Stages API Performance" href="profiling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Pulp Project
          </a>
              <div class="version">
                3.23.0.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../from-pulp-2.html">Changes From Pulp 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication/index.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/index.html">Workflows and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#plugin-writer-s-guide">Plugin Writer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plugin-writer-s-reference">Plugin Writer’s Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#plugin-api-reference">Plugin API Reference</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Plugin API Reference</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="models.html">pulpcore.plugin.models</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html">pulpcore.plugin.exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="serializers.html">pulpcore.plugin.serializers</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage.html">pulpcore.plugin.storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="viewsets.html">pulpcore.plugin.viewsets</a></li>
<li class="toctree-l4"><a class="reference internal" href="tasking.html">pulpcore.plugin.tasking</a></li>
<li class="toctree-l4"><a class="reference internal" href="download.html">pulpcore.plugin.download</a></li>
<li class="toctree-l4"><a class="reference internal" href="stages.html">pulpcore.plugin.stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="profiling.html">Profiling the Stages API Performance</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">pulpcore.plugin.content</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.html">pulpcore.plugin.util</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#pulpcore.plugin.PulpPluginAppConfig"><code class="docutils literal notranslate"><span class="pre">PulpPluginAppConfig</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rest_api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client_bindings.html">Client Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bugs-features.html">Bugs, Feature and Backport Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_process.html">Pulpcore Release Process</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pulp Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Plugin Development</a></li>
          <li class="breadcrumb-item"><a href="index.html">Plugin API Reference</a></li>
      <li class="breadcrumb-item active">pulpcore.plugin.content</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin_dev/api-reference/content-app.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pulpcore-plugin-content">
<span id="content-app-docs"></span><h1>pulpcore.plugin.content<a class="headerlink" href="#pulpcore-plugin-content" title="Permalink to this heading">¶</a></h1>
<p>The Content app provides built-in functionality to handle user requests for content, but in some
cases the default behavior may not work for some content types. For example, Container content requires
specific response headers to be present. In these cases the plugin write should provide a custom
Handler to the Content App by subclassing <cite>pulpcore.plugin.content.Handler</cite>.</p>
<p>Making a custom Handler is a two-step process:</p>
<ol class="arabic simple">
<li><p>subclass <cite>pulpcore.plugin.content.Handler</cite> to define your Handler’s behavior</p></li>
<li><p>Add the Handler to a route using aiohttp.server’s <a class="reference external" href="https://aiohttp.readthedocs.io/en/stable/web_reference.html#aiohttp.web.UrlDispatcher.add_route">add_route()</a> interface.</p></li>
</ol>
<p>If content needs to be served from within the <a class="reference internal" href="../../glossary.html#term-Distribution"><span class="xref std std-term">Distribution</span></a>’s base_path,
overriding the <code class="xref py py-meth docutils literal notranslate"><span class="pre">content_handler()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">content_handler_directory_listing()</span></code>
methods in your Distribution is an easier way to serve this content.</p>
<section id="creating-your-handler">
<h2>Creating your Handler<a class="headerlink" href="#creating-your-handler" title="Permalink to this heading">¶</a></h2>
<p>Import the Handler object through the plugin API and then subclass it. Custom functionality can be
provided by overriding the various methods of <cite>Handler</cite>, but here is the simplest version:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulpcore.plugin.content</span> <span class="kn">import</span> <span class="n">Handler</span>

<span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>

    <span class="k">pass</span>
</pre></div>
</div>
<p>Here is an example of the <a class="reference external" href="https://github.com/pulp/pulp_container/blob/master/pulp_container/app/registry.py">Container custom Handler</a>.</p>
</section>
<section id="registering-your-handler">
<h2>Registering your Handler<a class="headerlink" href="#registering-your-handler" title="Permalink to this heading">¶</a></h2>
<p>We register the Handler with Pulp’s Content App by importing the aiohttp.server ‘app’ and then
adding a custom route to it. Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulpcore.content</span> <span class="kn">import</span> <span class="n">app</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/my/custom/{somevar:.+}&#39;</span><span class="p">,</span> <span class="n">MyHandler</span><span class="p">()</span><span class="o">.</span><span class="n">stream_content</span><span class="p">)])</span>
</pre></div>
</div>
<p>Here is an example of <a class="reference external" href="https://github.com/pulp/pulp_container/blob/master/pulp_container/app/content.py">Container registering some custom routes</a>.</p>
</section>
<section id="restricting-which-detail-distributions-match">
<h2>Restricting which detail Distributions Match<a class="headerlink" href="#restricting-which-detail-distributions-match" title="Permalink to this heading">¶</a></h2>
<p>To restrict which Distribution model types your Handler will serve, set the <cite>distribution_model</cite>
field to your Model type. This causes the Handler to only search/serve your Distribution types.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulpcore.plugin.content</span> <span class="kn">import</span> <span class="n">Handler</span>

<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">MyDistribution</span>


<span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>

    <span class="n">distribution_model</span> <span class="o">=</span> <span class="n">MyDistribution</span>
</pre></div>
</div>
</section>
<section id="pulpcore-plugin-content-handler">
<h2>pulpcore.plugin.content.Handler<a class="headerlink" href="#pulpcore-plugin-content-handler" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.content.Handler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.content.</span></span><span class="sig-name descname"><span class="pre">Handler</span></span><a class="headerlink" href="#pulpcore.plugin.content.Handler" title="Permalink to this definition">¶</a></dt>
<dd><p>A default Handler for the Content App that also can be subclassed to create custom handlers.</p>
<p>This Handler will perform the following:</p>
<ol class="arabic simple">
<li><p>Match the request against a Distribution</p></li>
<li><p>Call the certguard check if a certguard exists for the matched Distribution.</p></li>
<li><p>If the Distribution has a <cite>publication</cite> serve that Publication’s <cite>PublishedArtifacts</cite>,
<cite>PublishedMetadata</cite> by the remaining <cite>relative path</cite>. If still unserved and if <cite>pass_through</cite>
is set, the associated <cite>repository_version</cite> will have its <cite>ContentArtifacts</cite> served by
<cite>relative_path</cite> also. This will serve the associated <cite>Artifact</cite>.</p></li>
<li><p>If still unmatched, and the Distribution has a <cite>repository</cite> attribute set, find it’s latest
<cite>repository_version</cite>. If the Distribution has a <cite>repository_version</cite> attribute set, use that.
For this <cite>repository_version</cite>, find matching <cite>ContentArtifact</cite> objects by <cite>relative_path</cite> and
serve them. If there is an associated <cite>Artifact</cite> return it.</p></li>
<li><p>If the Distribution has a <cite>remote</cite>, find an associated <cite>RemoteArtifact</cite> that matches by
<cite>relative_path</cite>. Fetch and stream the corresponding <cite>RemoteArtifact</cite> to the client,
optionally saving the <cite>Artifact</cite> depending on the <cite>policy</cite> attribute.</p></li>
</ol>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="profiling.html" class="btn btn-neutral float-left" title="Profiling the Stages API Performance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="util.html" class="btn btn-neutral float-right" title="pulpcore.plugin.util" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Pulp Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74748547-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
$( document ).ready( function() {

  // gets version number minus whitespace and bugfix version
  var $version_number = $('.version').text().trim().split('.', 2).join('.')

  // div mirroring the admonition-warning generated by sphinx if added to .rst
  var warning = '\
          <div class="admonition warning"> \
              <p class="first admonition-title">Warning</p> \
              <p class="last">You are looking at the docs for an unsupported version of Pulp. \
               Consider switching to a  \
               <a href="https://pulpproject.org/docs/">supported version</a></p> \
          </div>'

  
  // get JSON from server and load supported_versions
  $.getJSON("https://raw.githubusercontent.com/pulp/pulp-ci/master/ci/config/releases/supported-releases.json" , function(data) {
    if ($.inArray($version_number, data) === -1) {
      $('.rst-content').prepend(warning)
      }
    })
  })
  </script>


</body>
</html>
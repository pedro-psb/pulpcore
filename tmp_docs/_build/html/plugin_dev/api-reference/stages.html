<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pulpcore.plugin.stages &mdash; Pulp Project 3.23.0.dev documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Profiling the Stages API Performance" href="profiling.html" />
    <link rel="prev" title="pulpcore.plugin.download" href="download.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Pulp Project
          </a>
              <div class="version">
                3.23.0.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../from-pulp-2.html">Changes From Pulp 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication/index.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflows/index.html">Workflows and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#plugin-writer-s-guide">Plugin Writer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plugin-writer-s-reference">Plugin Writer’s Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#plugin-api-reference">Plugin API Reference</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Plugin API Reference</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="models.html">pulpcore.plugin.models</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html">pulpcore.plugin.exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="serializers.html">pulpcore.plugin.serializers</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage.html">pulpcore.plugin.storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="viewsets.html">pulpcore.plugin.viewsets</a></li>
<li class="toctree-l4"><a class="reference internal" href="tasking.html">pulpcore.plugin.tasking</a></li>
<li class="toctree-l4"><a class="reference internal" href="download.html">pulpcore.plugin.download</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">pulpcore.plugin.stages</a></li>
<li class="toctree-l4"><a class="reference internal" href="profiling.html">Profiling the Stages API Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="content-app.html">pulpcore.plugin.content</a></li>
<li class="toctree-l4"><a class="reference internal" href="util.html">pulpcore.plugin.util</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#pulpcore.plugin.PulpPluginAppConfig"><code class="docutils literal notranslate"><span class="pre">PulpPluginAppConfig</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rest_api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client_bindings.html">Client Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bugs-features.html">Bugs, Feature and Backport Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_process.html">Pulpcore Release Process</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pulp Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Plugin Development</a></li>
          <li class="breadcrumb-item"><a href="index.html">Plugin API Reference</a></li>
      <li class="breadcrumb-item active">pulpcore.plugin.stages</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin_dev/api-reference/stages.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pulpcore-plugin-stages">
<span id="stages-api-docs"></span><h1>pulpcore.plugin.stages<a class="headerlink" href="#pulpcore-plugin-stages" title="Permalink to this heading">¶</a></h1>
<p>Plugin writers can use the Stages API to create a high-performance, download-and-saving pipeline
to make writing sync code easier. There are several parts to the API:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#declarative-version"><span class="std std-ref">DeclarativeVersion</span></a> is a generic pipeline useful for most synchronization use cases.</p></li>
<li><p>The builtin Stages including <a class="reference internal" href="#artifact-stages"><span class="std std-ref">Artifact Related Stages</span></a> and <a class="reference internal" href="#content-stages"><span class="std std-ref">Content Related Stages</span></a>.</p></li>
<li><p>The <a class="reference internal" href="#stages-api"><span class="std std-ref">Stages API</span></a>, which allows you to build custom stages and pipelines.</p></li>
</ol>
<section id="declarativeversion">
<span id="declarative-version"></span><h2>DeclarativeVersion<a class="headerlink" href="#declarativeversion" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.DeclarativeVersion">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">DeclarativeVersion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">first_stage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repository</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mirror</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">acs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.DeclarativeVersion" title="Permalink to this definition">¶</a></dt>
<dd><p>A pipeline that creates a new <code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code> from a
stream of <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> objects.</p>
<p>The plugin writer needs to specify a first_stage that will create a
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> object for each Content unit that should
exist in the <code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code>.</p>
<p>The pipeline stages perform the following steps by default:</p>
<ol class="arabic simple">
<li><p>Create the new <code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code></p></li>
<li><p>Use the provided <cite>first_stage</cite> to construct
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a></p></li>
<li><p>Query existing artifacts to determine which are already local to Pulp with
<a class="reference internal" href="#pulpcore.plugin.stages.QueryExistingArtifacts" title="pulpcore.plugin.stages.QueryExistingArtifacts"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryExistingArtifacts</span></code></a></p></li>
<li><p>Download any undownloaded <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects with
<a class="reference internal" href="#pulpcore.plugin.stages.ArtifactDownloader" title="pulpcore.plugin.stages.ArtifactDownloader"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArtifactDownloader</span></code></a></p></li>
<li><p>Save the newly downloaded <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects with
<a class="reference internal" href="#pulpcore.plugin.stages.ArtifactSaver" title="pulpcore.plugin.stages.ArtifactSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArtifactSaver</span></code></a></p></li>
<li><p>Query for Content units already present in Pulp with
<a class="reference internal" href="#pulpcore.plugin.stages.QueryExistingContents" title="pulpcore.plugin.stages.QueryExistingContents"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryExistingContents</span></code></a></p></li>
<li><p>Save new Content units not yet present in Pulp with
<a class="reference internal" href="#pulpcore.plugin.stages.ContentSaver" title="pulpcore.plugin.stages.ContentSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentSaver</span></code></a></p></li>
<li><p>Attach <code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteArtifact</span></code> to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Content</span></code> via
<a class="reference internal" href="#pulpcore.plugin.stages.RemoteArtifactSaver" title="pulpcore.plugin.stages.RemoteArtifactSaver"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteArtifactSaver</span></code></a></p></li>
<li><p>Resolve the attached <code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code> of
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> with
<a class="reference internal" href="#pulpcore.plugin.stages.ResolveContentFutures" title="pulpcore.plugin.stages.ResolveContentFutures"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResolveContentFutures</span></code></a></p></li>
<li><p>Associate all content units with the new
<code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code> with
<a class="reference internal" href="#pulpcore.plugin.stages.ContentAssociation" title="pulpcore.plugin.stages.ContentAssociation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentAssociation</span></code></a></p></li>
<li><p>Unassociate any content units not declared in the stream (only when mirror=True)
with <code class="xref py py-class docutils literal notranslate"><span class="pre">ContentUnassociation</span></code></p></li>
</ol>
<p>To do this, the plugin writer should subclass the
<a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a> class and define its
<code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> interface which returns a coroutine. This coroutine should
download metadata, create the corresponding
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> objects, and put them into the
<code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.Queue</span></code> via <code class="xref py py-meth docutils literal notranslate"><span class="pre">put()</span></code> to send them down the pipeline. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFirstStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">remote</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">remote</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">downloader</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">get_downloader</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">remote</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">downloader</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">read_my_metadata_file_somehow</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">MyContent</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>  <span class="c1"># make the content unit in memory-only</span>
            <span class="n">artifact</span> <span class="o">=</span> <span class="n">Artifact</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>  <span class="c1"># make Artifact in memory-only</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">DeclarativeArtifact</span><span class="p">(</span><span class="n">artifact</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">relative_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">)</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="n">DeclarativeContent</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">d_artifacts</span><span class="o">=</span><span class="p">[</span><span class="n">da</span><span class="p">])</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
</pre></div>
</div>
<p>To use your first stage with the pipeline you have to instantiate the subclass and pass it
to <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeVersion" title="pulpcore.plugin.stages.DeclarativeVersion"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeVersion</span></code></a>.</p>
<ol class="arabic simple">
<li><p>Create the instance of the subclassed <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a> object.</p></li>
<li><p>Create the <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeVersion" title="pulpcore.plugin.stages.DeclarativeVersion"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeVersion</span></code></a> instance, passing the
<a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a> subclass instance to it</p></li>
<li><p>Call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code> method on your
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeVersion" title="pulpcore.plugin.stages.DeclarativeVersion"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeVersion</span></code></a> instance</p></li>
</ol>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first_stage</span> <span class="o">=</span> <span class="n">MyFirstStage</span><span class="p">(</span><span class="n">remote</span><span class="p">)</span>
<span class="n">DeclarativeVersion</span><span class="p">(</span><span class="n">first_stage</span><span class="p">,</span> <span class="n">repository_version</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>first_stage</strong> (<a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a>) – The first stage to receive
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> from.</p></li>
<li><p><strong>repository</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Repository</span></code>) – The repository receiving the
new version.</p></li>
<li><p><strong>mirror</strong> (<em>bool</em>) – ‘True’ removes content units from the
<code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code> that are not
requested in the <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeVersion" title="pulpcore.plugin.stages.DeclarativeVersion"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeVersion</span></code></a> stream.
‘False’ (additive) only adds content units observed in the
<code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeVersion</span> <span class="pre">stream</span></code>, and does not remove any
pre-existing units in the <code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code>.
‘False’ is the default.</p></li>
<li><p><strong>acs</strong> (<em>bool</em>) – When set to ‘True’ a new stage is added to look for
Alternate Content Sources.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.DeclarativeArtifact">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">DeclarativeArtifact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">artifact</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">urls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relative_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deferred_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="Permalink to this definition">¶</a></dt>
<dd><p>Relates an <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>, how to download it, and its
<cite>relative_path</cite> used later during publishing.</p>
<p>This is used by the Stages API stages to determine if an
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> is already present and ensure Pulp can download it in
the future. The <cite>artifact</cite> can be either saved or unsaved. If unsaved, the <cite>artifact</cite> attributes
may be incomplete because not all digest information can be computed until the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> is downloaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>artifact</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>) – An
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> either saved or unsaved. If unsaved, it
may have partial digest information attached to it.</p></li>
<li><p><strong>url</strong> (<em>str</em>) – the url to fetch the <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> from.</p></li>
<li><p><strong>urls</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – A list of many possible URLs to fetch the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> from.</p></li>
<li><p><strong>relative_path</strong> (<em>str</em>) – the relative_path this <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>
should be published at for any Publication.</p></li>
<li><p><strong>remote</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Remote</span></code>) – The remote used to fetch this
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p></li>
<li><p><strong>extra_data</strong> (<em>dict</em>) – A dictionary available for additional data to be stored in.</p></li>
<li><p><strong>deferred_download</strong> (<em>bool</em>) – Whether this artifact should be downloaded and saved
in the artifact stages. Defaults to <cite>False</cite>. See <a class="reference internal" href="../reference/on-demand-support.html#on-demand-support"><span class="std std-ref">On-Demand Support</span></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If <cite>artifact</cite>, <cite>url</cite>, or <cite>relative_path</cite> are not specified. If <cite>remote</cite> is not</p></li>
<li><p><strong>specified and artifact doesn't have a file.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.DeclarativeContent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">DeclarativeContent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">content</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d_artifacts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.DeclarativeContent" title="Permalink to this definition">¶</a></dt>
<dd><p>Relates a Content unit and zero or more <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a>
objects.</p>
<p>This is used by the Stages API stages to determine if a Content unit is already present and
ensure all of its associated <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects are
related correctly. The <cite>content</cite> can be either saved or unsaved depending on where in the Stages
API pipeline this is used.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>content</strong> (subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">Content</span></code>) – A Content unit, possibly
unsaved</p></li>
<li><p><strong>d_artifacts</strong> (<em>list</em>) – A list of zero or more
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects associated with <cite>content</cite>.</p></li>
<li><p><strong>extra_data</strong> (<em>dict</em>) – A dictionary available for additional data to be stored in.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – If <cite>content</cite> is not specified.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.DeclarativeContent.resolution">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">resolution</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.DeclarativeContent.resolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Coroutine that waits for the content to be saved to database.
Returns the content unit.</p>
</dd></dl>

</dd></dl>

</section>
<section id="stages-api">
<span id="id1"></span><h2>Stages API<a class="headerlink" href="#stages-api" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.create_pipeline">
<em class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">create_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.create_pipeline" title="Permalink to this definition">¶</a></dt>
<dd><p>A coroutine that builds a Stages API linear pipeline from the list <cite>stages</cite> and runs it.</p>
<p>Each stage is an instance of a class derived from <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">pulpcore.plugin.stages.Stage</span></code></a> that
implements the <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> coroutine. This coroutine reads asynchronously either from the
<cite>items()</cite> iterator or the <cite>batches()</cite> iterator and outputs the items with <cite>put()</cite>. Here is an
example of the simplest stage that only passes data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStage</span><span class="p">(</span><span class="n">Stage</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">d_content</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># Fetch items from the previous stage</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">d_content</span><span class="p">)</span>  <span class="c1"># Hand them over to the next stage</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stages</strong> (<em>list</em><em> of </em><em>coroutines</em>) – A list of Stages API compatible coroutines.</p></li>
<li><p><strong>maxsize</strong> (<em>int</em>) – The maximum amount of items a queue between two stages should hold. Optional
and defaults to 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A single coroutine that can be used to run, wait, or cancel the entire pipeline with.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – When a stage instance is specified more than once.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.Stage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">Stage</span></span><a class="headerlink" href="#pulpcore.plugin.stages.Stage" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for all Stages API stages.</p>
<p>To make a stage, inherit from this class and implement <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> on the subclass.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.Stage.__call__">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.Stage.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>This coroutine makes the stage callable.</p>
<p>It calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> and signals the next stage that its work is finished.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.EndStage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">EndStage</span></span><a class="headerlink" href="#pulpcore.plugin.stages.EndStage" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that drains incoming items and does nothing with the items. This is
required at the end of all pipelines.</p>
<p>Without this stage, the <cite>maxsize</cite> of the last stage’s <cite>_out_q</cite> could fill up and block the
entire pipeline.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.EndStage.__call__">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.EndStage.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>This method drains items from the last queue and drops them.</p>
<p>Importantly it does not try to put items into the nonexistent next queue.</p>
</dd></dl>

</dd></dl>

</section>
<section id="artifact-related-stages">
<span id="artifact-stages"></span><h2>Artifact Related Stages<a class="headerlink" href="#artifact-related-stages" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ArtifactDownloader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">ArtifactDownloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_concurrent_content</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.ArtifactDownloader" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage to download <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> files, but don’t save
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> in the db.</p>
<p>This stage downloads the file for any <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects missing
files and creates a new <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> object from the downloaded
file and its digest data. The new <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> is not saved but
added to the <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object, replacing the likely
incomplete <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p>
<p>Each <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> is sent to <cite>self._out_q</cite> after all of
its <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects have been handled.</p>
<p>This stage creates a ProgressReport named ‘Downloading Artifacts’ that counts the number of
downloads completed. Since it’s a stream the total count isn’t known until it’s finished.</p>
<p>This stage drains all available items from <cite>self._in_q</cite> and starts as many downloaders as
possible (up to <cite>download_concurrency</cite> set on a Remote)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_concurrent_content</strong> (<em>int</em>) – The maximum number of
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> instances to handle simultaneously.
Default is 200.</p></li>
<li><p><strong>args</strong> – unused positional arguments passed along to <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a>.</p></li>
<li><p><strong>kwargs</strong> – unused keyword arguments passed along to <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ArtifactSaver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">ArtifactSaver</span></span><a class="headerlink" href="#pulpcore.plugin.stages.ArtifactSaver" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that saves any unsaved <code class="xref py py-attr docutils literal notranslate"><span class="pre">DeclarativeArtifact.artifact</span></code> objects.</p>
<p>This stage expects <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> units from <cite>self._in_q</cite>
and inspects their associated <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects. Each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object stores one
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p>
<p>Any unsaved <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects are saved. Each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> is sent to <cite>self._out_q</cite> after all of its
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects have been handled.</p>
<p>This stage drains all available items from <cite>self._in_q</cite> and batches everything into one large
call to the db for efficiency.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.RemoteArtifactSaver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">RemoteArtifactSaver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fix_mismatched_remote_artifacts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.RemoteArtifactSaver" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stage that saves <code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteArtifact</span></code> objects</p>
<p>An <code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteArtifact</span></code> object is saved for each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.QueryExistingArtifacts">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">QueryExistingArtifacts</span></span><a class="headerlink" href="#pulpcore.plugin.stages.QueryExistingArtifacts" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that replaces <code class="xref py py-attr docutils literal notranslate"><span class="pre">DeclarativeContent.content</span></code> objects with already-saved
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects.</p>
<p>This stage expects <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> units from <cite>self._in_q</cite>
and inspects their associated <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects. Each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object stores one
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p>
<p>This stage inspects any unsaved <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects and searches
using their metadata for existing saved <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code> objects inside
Pulp with the same digest value(s). Any existing <code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>
objects found will replace their unsaved counterpart in the
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object.</p>
<p>Each <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> is sent to <cite>self._out_q</cite> after all of
its <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects have been handled.</p>
<p>This stage drains all available items from <cite>self._in_q</cite> and batches everything into one large
call to the db for efficiency.</p>
</dd></dl>

</section>
<section id="content-related-stages">
<span id="content-stages"></span><h2>Content Related Stages<a class="headerlink" href="#content-related-stages" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ContentSaver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">ContentSaver</span></span><a class="headerlink" href="#pulpcore.plugin.stages.ContentSaver" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that saves <code class="xref py py-attr docutils literal notranslate"><span class="pre">DeclarativeContent.content</span></code> objects and saves its related
<code class="xref py py-class docutils literal notranslate"><span class="pre">ContentArtifact</span></code> objects too.</p>
<p>This stage expects <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> units from <cite>self._in_q</cite>
and inspects their associated <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects. Each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object stores one
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p>
<p>Each “unsaved” Content objects is saved and a <code class="xref py py-class docutils literal notranslate"><span class="pre">ContentArtifact</span></code>
objects too.</p>
<p>Each <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> is sent to after it has been handled.</p>
<p>This stage drains all available items from <cite>self._in_q</cite> and batches everything into one large
call to the db for efficiency.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ContentSaver._post_save">
<span class="sig-name descname"><span class="pre">_post_save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.ContentSaver._post_save" title="Permalink to this definition">¶</a></dt>
<dd><p>A hook plugin-writers can override to save related objects after content unit saving.</p>
<p>This is run within the same transaction as the content unit saving.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>batch</strong> (list of <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a>) – The batch of
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> objects to be saved.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ContentSaver._pre_save">
<span class="sig-name descname"><span class="pre">_pre_save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.ContentSaver._pre_save" title="Permalink to this definition">¶</a></dt>
<dd><p>A hook plugin-writers can override to save related objects prior to content unit saving.</p>
<p>This is run within the same transaction as the content unit saving.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>batch</strong> (list of <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a>) – The batch of
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> objects to be saved.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.QueryExistingContents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">QueryExistingContents</span></span><a class="headerlink" href="#pulpcore.plugin.stages.QueryExistingContents" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that saves <code class="xref py py-attr docutils literal notranslate"><span class="pre">DeclarativeContent.content</span></code> objects and saves its related
<code class="xref py py-class docutils literal notranslate"><span class="pre">ContentArtifact</span></code> objects too.</p>
<p>This stage expects <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> units from <cite>self._in_q</cite>
and inspects their associated <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> objects. Each
<a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeArtifact" title="pulpcore.plugin.stages.DeclarativeArtifact"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeArtifact</span></code></a> object stores one
<code class="xref py py-class docutils literal notranslate"><span class="pre">Artifact</span></code>.</p>
<p>This stage inspects any “unsaved” Content unit objects and searches for existing saved Content
units inside Pulp with the same unit key. Any existing Content objects found, replace their
“unsaved” counterpart in the <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> object.</p>
<p>Each <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> is sent to <cite>self._out_q</cite> after it has
been handled.</p>
<p>This stage drains all available items from <cite>self._in_q</cite> and batches everything into one large
call to the db for efficiency.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ResolveContentFutures">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">ResolveContentFutures</span></span><a class="headerlink" href="#pulpcore.plugin.stages.ResolveContentFutures" title="Permalink to this definition">¶</a></dt>
<dd><p>This stage resolves the futures in <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a>.</p>
<p>Futures results are set to the found/created <code class="xref py py-class docutils literal notranslate"><span class="pre">Content</span></code>.</p>
<p>This is useful when data downloaded from the plugin API needs to be parsed by FirstStage to
create additional <a class="reference internal" href="#pulpcore.plugin.stages.DeclarativeContent" title="pulpcore.plugin.stages.DeclarativeContent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeclarativeContent</span></code></a> objects to be send down
the pipeline. Consider an example where content type <cite>Foo</cite> references additional instances of a
different content type <cite>Bar</cite>. Consider this code in FirstStage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create d_content and d_artifact for a `foo_a`</span>
<span class="n">foo_a</span> <span class="o">=</span> <span class="n">DeclarativeContent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c1"># Send it in the pipeline</span>
<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">foo_a</span><span class="p">)</span>

<span class="o">...</span>

<span class="n">foo_a_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">foo_a</span><span class="o">.</span><span class="n">resolution</span><span class="p">()</span>  <span class="c1"># awaits until the foo_a reaches this stage</span>
</pre></div>
</div>
<p>This creates a “looping” pattern, of sorts, where downloaded content at the end of the pipeline
can introduce new additional to-be-downloaded content at the beginning of the pipeline.
On the other hand, it can impose a substantial performance decrement of batching content in the
earlier stages.
If you want to drop a declarative content prematurely from the pipeline, use the function
<cite>resolve()</cite> to unblock the coroutines awaiting the attached future and do not hand the content
to the next stage.
As a rule of thumb, sending more items into the pipeline first and awaiting their resolution
later is better.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pulpcore.plugin.stages.ContentAssociation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pulpcore.plugin.stages.</span></span><span class="sig-name descname"><span class="pre">ContentAssociation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_version</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mirror</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pulpcore.plugin.stages.ContentAssociation" title="Permalink to this definition">¶</a></dt>
<dd><p>A Stages API stage that associates content units with <cite>new_version</cite>.</p>
<p>This stage stores all content unit primary keys in memory before running. This is done to
compute the units already associated but not received from <cite>self._in_q</cite>. These units are passed
via <cite>self._out_q</cite> to the next stage as a <code class="xref py py-class docutils literal notranslate"><span class="pre">django.db.models.query.QuerySet</span></code>.</p>
<p>This stage creates a ProgressReport named ‘Associating Content’ that counts the number of units
associated. Since it’s a stream the total count isn’t known until it’s finished.</p>
<p>If <cite>mirror</cite> was enabled, then content units may also be un-assocated (removed) from
<cite>new_version</cite>. A ProgressReport named ‘Un-Associating Content’ is created that counts the number
of units un-associated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new_version</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">RepositoryVersion</span></code>) – The repo version this
stage associates content with.</p></li>
<li><p><strong>mirror</strong> (<em>bool</em>) – Whether or not to “mirror” the stream of DeclarativeContent - whether content
not in the stream should be removed from the repository.</p></li>
<li><p><strong>args</strong> – unused positional arguments passed along to <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a>.</p></li>
<li><p><strong>kwargs</strong> – unused keyword arguments passed along to <a class="reference internal" href="#pulpcore.plugin.stages.Stage" title="pulpcore.plugin.stages.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="download.html" class="btn btn-neutral float-left" title="pulpcore.plugin.download" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="profiling.html" class="btn btn-neutral float-right" title="Profiling the Stages API Performance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Pulp Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74748547-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
$( document ).ready( function() {

  // gets version number minus whitespace and bugfix version
  var $version_number = $('.version').text().trim().split('.', 2).join('.')

  // div mirroring the admonition-warning generated by sphinx if added to .rst
  var warning = '\
          <div class="admonition warning"> \
              <p class="first admonition-title">Warning</p> \
              <p class="last">You are looking at the docs for an unsupported version of Pulp. \
               Consider switching to a  \
               <a href="https://pulpproject.org/docs/">supported version</a></p> \
          </div>'

  
  // get JSON from server and load supported_versions
  $.getJSON("https://raw.githubusercontent.com/pulp/pulp-ci/master/ci/config/releases/supported-releases.json" , function(data) {
    if ($.inArray($version_number, data) === -1) {
      $('.rst-content').prepend(warning)
      }
    })
  })
  </script>


</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pulp Import/Export &mdash; Pulp Project 3.23.0.dev documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Pulp Replication" href="replication.html" />
    <link rel="prev" title="Viewsets" href="viewsets.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> Pulp Project
          </a>
              <div class="version">
                3.23.0.dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts.html">Concepts and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../from-pulp-2.html">Changes From Pulp 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../components.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/index.html">Installation Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../authentication/index.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflows/index.html">Workflows and Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html#plugin-writer-s-guide">Plugin Writer’s Guide</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Plugin Writer’s Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../planning-guide.html">Plugin Planning Guide</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html">Plugin Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#zero-downtime-migrations">Zero-Downtime Migrations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#data-migrations">Data Migrations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#tasking-system">Tasking System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugin-walkthrough.html">Plugin Walkthrough</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#plugin-writer-s-reference">Plugin Writer’s Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#plugin-api-reference">Plugin API Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rest_api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../client_bindings.html">Client Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bugs-features.html">Bugs, Feature and Backport Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release_process.html">Pulpcore Release Process</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Pulp Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Plugin Development</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Plugin Writer’s Guide</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Plugin Concepts</a></li>
      <li class="breadcrumb-item active">Pulp Import/Export</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/plugin_dev/plugin-writer/concepts/subclassing/import-export.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pulp-import-export">
<span id="subclassing-import-export"></span><h1>Pulp Import/Export<a class="headerlink" href="#pulp-import-export" title="Permalink to this heading">¶</a></h1>
<p>The Pulp Import/Export process is based around the <a class="reference external" href="https://django-import-export.readthedocs.io/en/latest/">Django Import/Export library</a> .
To be ‘exportable/importable’, your plugin must define a <code class="docutils literal notranslate"><span class="pre">modelresource</span></code> module at
<code class="docutils literal notranslate"><span class="pre">&lt;plugin&gt;/app/modelresource.py</span></code>. The module must contain a ModelResource subclass
for each Model you want to expose, and it must define an <code class="docutils literal notranslate"><span class="pre">IMPORT_ORDER</span></code> ordered list
for all such ModelResources.</p>
<section id="querymodelresource">
<h2>QueryModelResource<a class="headerlink" href="#querymodelresource" title="Permalink to this heading">¶</a></h2>
<p>If you don’t need to do anything “special” to export your Model you can subclass
<code class="docutils literal notranslate"><span class="pre">pulpcore.plugin.importexport.QueryModelResource</span></code>. This only requires you to provide the
<code class="docutils literal notranslate"><span class="pre">Meta.model</span></code> class for the Model being export/imported, and to override the
<code class="docutils literal notranslate"><span class="pre">set_up_queryset(self)</span></code> method to define a limiting filter. QueryModelResource is instantiated
by the export process with the RepositoryVersion being exported (<code class="docutils literal notranslate"><span class="pre">self.repo_version</span></code>).</p>
<p>An example <code class="docutils literal notranslate"><span class="pre">QueryModelResource</span></code> subclasses, for import/exporting the <code class="docutils literal notranslate"><span class="pre">Bar</span></code> Model
from <code class="docutils literal notranslate"><span class="pre">pulp_foo</span></code>, would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BarResource</span><span class="p">(</span><span class="n">QueryModelResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource for import/export of foo_bar entities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_up_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: Bars specific to a specified repo-version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Bar</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Bar</span>
</pre></div>
</div>
</section>
<section id="basecontentresource">
<h2>BaseContentResource<a class="headerlink" href="#basecontentresource" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">BaseContentResource</span></code> class provides a base class for exporting <code class="docutils literal notranslate"><span class="pre">Content</span></code>.
<code class="docutils literal notranslate"><span class="pre">BaseContentResource</span></code> provides extra functionality on top of <code class="docutils literal notranslate"><span class="pre">QueryModelResource</span></code> specific to
handling the exporting and importing of Content such as handling of Content-specific fields like
<code class="docutils literal notranslate"><span class="pre">upstream_id</span></code>.</p>
<p>An example of subclassing <code class="docutils literal notranslate"><span class="pre">BaseContentResource</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyContentResource</span><span class="p">(</span><span class="n">BaseContentResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource for import/export of MyContent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_up_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: MyContent specific to a specified repo-version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MyContent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">MyContent</span>
</pre></div>
</div>
</section>
<section id="modelresource-py">
<h2>modelresource.py<a class="headerlink" href="#modelresource-py" title="Permalink to this heading">¶</a></h2>
<p>A simple <code class="docutils literal notranslate"><span class="pre">modelresource.py</span></code> module is the one for the <code class="docutils literal notranslate"><span class="pre">pulp_file</span></code> plugin. It looks like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulpcore.plugin.importexport</span> <span class="kn">import</span> <span class="n">BaseContentResource</span>
<span class="kn">from</span> <span class="nn">pulp_file.app.models</span> <span class="kn">import</span> <span class="n">FileContent</span>

<span class="k">class</span> <span class="nc">FileContentResource</span><span class="p">(</span><span class="n">BaseContentResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource for import/export of file_filecontent entities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_up_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: FileContents specific to a specified repo-version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FileContent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">FileContent</span>


<span class="n">IMPORT_ORDER</span> <span class="o">=</span> <span class="p">[</span><span class="n">FileContentResource</span><span class="p">]</span>
</pre></div>
</div>
<p>Plugin writers are encouraged to subclass the <code class="docutils literal notranslate"><span class="pre">RepositoryResource</span></code> class to enable automatic
repository creation during the import. For the <code class="docutils literal notranslate"><span class="pre">pulp_file</span></code> plugin, the following implementation
should be considered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pulpcore.plugin.modelresources</span> <span class="kn">import</span> <span class="n">RepositoryResource</span>
<span class="kn">from</span> <span class="nn">pulp_file.app.models</span> <span class="kn">import</span> <span class="n">FileRepository</span>

<span class="k">class</span> <span class="nc">FileRepositoryResource</span><span class="p">(</span><span class="n">RepositoryResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A resource for importing/exporting file repository entities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_up_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A queryset containing one repository that will be exported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FileRepository</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="o">.</span><span class="n">repository</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">FileRepository</span>


<span class="c1"># the list signifying the order of imports must also include the repository resource class</span>
<span class="n">IMPORT_ORDER</span> <span class="o">=</span> <span class="p">[</span><span class="n">FileContentResource</span><span class="p">,</span> <span class="n">FileRepositoryResource</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="content-mapping">
<h2>content_mapping<a class="headerlink" href="#content-mapping" title="Permalink to this heading">¶</a></h2>
<p>By default, all the Content that gets imported is automatically associated with the Repository it
is stored with inside the export archive. In some cases, this may not be desirable. One such case is
when there is Content that is tied to a sub_repo but not directly to the Repository itself. Another
case is where you may have Content you want imported but not associated with a Repositoy. In such
cases, you can set a <code class="docutils literal notranslate"><span class="pre">content_mapping</span></code> property on the Resource.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">content_mapping</span></code> property should be a dictionary that maps repository names to a list of
content_ids. The importer code in pulp will combine the <code class="docutils literal notranslate"><span class="pre">content_mappings</span></code> across Resources and
export them to a <code class="docutils literal notranslate"><span class="pre">content_mapping.json</span></code> file that it will use during import to map Content to
Repositories.</p>
<p>Here is an example that deals with subrepos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyContentResource</span><span class="p">(</span><span class="n">BaseContentResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource for import/export of MyContent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override __init__ to set content_mapping to a dict.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_up_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the queryset and our content_mapping.&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">MyContent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">repository_version</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>

        <span class="k">for</span> <span class="n">repo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subrepos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo_version</span><span class="p">):</span>
            <span class="n">subrepo_content</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">latest_repository_version</span><span class="o">.</span><span class="n">content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content_mapping</span><span class="p">[</span><span class="n">repo</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subrepo_content</span>
            <span class="n">content</span> <span class="o">|=</span> <span class="n">subrepo_content</span>

        <span class="k">return</span> <span class="n">content</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">MyContent</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="viewsets.html" class="btn btn-neutral float-left" title="Viewsets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="replication.html" class="btn btn-neutral float-right" title="Pulp Replication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Pulp Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74748547-2', 'auto');
  ga('send', 'pageview');

</script>


<script>
$( document ).ready( function() {

  // gets version number minus whitespace and bugfix version
  var $version_number = $('.version').text().trim().split('.', 2).join('.')

  // div mirroring the admonition-warning generated by sphinx if added to .rst
  var warning = '\
          <div class="admonition warning"> \
              <p class="first admonition-title">Warning</p> \
              <p class="last">You are looking at the docs for an unsupported version of Pulp. \
               Consider switching to a  \
               <a href="https://pulpproject.org/docs/">supported version</a></p> \
          </div>'

  
  // get JSON from server and load supported_versions
  $.getJSON("https://raw.githubusercontent.com/pulp/pulp-ci/master/ci/config/releases/supported-releases.json" , function(data) {
    if ($.inArray($version_number, data) === -1) {
      $('.rst-content').prepend(warning)
      }
    })
  })
  </script>


</body>
</html>